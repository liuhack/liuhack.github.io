<!DOCTYPE html>
<html>

    <head>
        <title>  &middot; LiUhack - CTF team at LiU </title>

        <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.54.0" />


<script   src="https://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">


<link rel="stylesheet" href="https://liuhack.github.io/css/nix.css">


<link href="https://fonts.googleapis.com/css?family=Inconsolata%7COpen+Sans%7CConcert+One" rel="stylesheet">




    </head>

    <body>
	
        <header>
<nav class="navbar navbar-default navbar-fixed-top navbar-inverse font-header">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-1" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" id="green-terminal" href=https://liuhack.github.io>LiUhack@LiUhack.se ~ $</a>
		</div>

		
		<div class="collapse navbar-collapse" id="navbar-collapse-1">
			<ul class="nav navbar-nav navbar-right">
				<li>
					<a href="https://liuhack.github.io">/home/LiUhack</a>
				</li>
				
				
				<li class="dropdown">
                    
            		<a href="https://liuhack.github.io/writeups">~/writeups</a>
            		
        		</li>
        		

			</ul>
		</div>
	</div>
</nav>
</header>

        <div class="container wrapper">
            <h1><a href="https://liuhack.github.io/writeups/2018/csaw/flatcrypt/readme/"></a></h1>
            <span class="post-date">Jan 1, 0001 </span>
            <div class="post-content">
                

<h1 id="flatcrypt">flatcrypt</h1>

<p>There is a server provided that combines a input message <code>f</code> with the flag <code>PROBLEM_KEY</code>, then compresses and encrypts it. The relevant code looks like this:</p>

<pre><code>if (len(f)&gt;=20):
    data = bytes((PROBLEM_KEY + f).encode('utf-8'))
    ctr = Counter.new(64, prefix=os.urandom(8))
    enc = AES.new(ENCRYPT_KEY, AES.MODE_CTR, counter=ctr).encrypt(zlib.compress(data))
    print(&quot;%s%s&quot; %(enc, chr(len(enc))))
</code></pre>

<p>With the allowed characterset of <code>f</code> being lowercase letters and underscore.</p>

<p>What stands out here is that the length of the encrypted message is explicitly returned, and that the data is compressed. Zlib will be more efficient at compressing repetitive data and AES in counter mode does not use padding, so messages already contained in the flag will give a shorter result. We start by repeating a single character 20 times to reach the minimum message size and notice that the letter <code>o</code> gives the shortest result. We take this as our partial flag and add another letter, this time giving us <code>go</code>, then <code>ogo</code> and so on, until the full flag is revealed: <code>crime_doesnt_have_a_logo</code>.</p>

            </div>
            
            <div class="post-comments">
                
            </div>
            
            <div class="push"></div>
        </div>
        <footer class="footer text-center">
<p>
    <a href="https://ctftime.org/team/57588">LiUhack @ CTFtime.org</a>
</p>
</footer>
    </body>
